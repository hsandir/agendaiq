#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "${YELLOW}üîç Running pre-commit checks...${NC}"

# 1. Check for sensitive data
echo "Checking for sensitive data..."
if grep -r "password\|secret\|token\|api_key" --include="*.env*" . 2>/dev/null; then
  echo "${RED}‚ùå Found sensitive data in env files! Use .env.example instead${NC}"
  exit 1
fi

# 2. Strict ESLint check (blocking)
echo "Running strict ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "${RED}‚ùå ESLint errors found - must be fixed before commit${NC}"
  exit 1
fi

# 3. Strict TypeScript check (blocking)
echo "Running strict TypeScript check..."
npx tsc --project tsconfig.build.json
if [ $? -ne 0 ]; then
  echo "${RED}‚ùå TypeScript errors found - must be fixed before commit${NC}"
  exit 1
fi

echo "${GREEN}‚úÖ All pre-commit checks passed!${NC}"
